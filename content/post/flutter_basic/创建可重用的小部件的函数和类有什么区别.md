---
title: "创建可重用的小部件的函数和类有什么区别"
date: 2021-09-09T08:58:56+08:00
draft: false
author: ""
authorLink: ""
description: ""
images: []
tags: ["Flutter","dart"]
categories: ["Flutter","dart"]
---

使用函数而不是类有一个重要的区别，那就是：框架不知道函数，但可以看到类。

考虑以下“小部件”功能：

```dart
Widget functionWidget({ Widget child}) {
  return Container(child: child);
}
```

用这种方式：

```dart
functionWidget(
  child: functionWidget(),
);
```

它是类等价的：

```dart
class ClassWidget extends StatelessWidget {
  final Widget child;

  const ClassWidget({Key key, this.child}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Container(
      child: child,
    );
  }
}
```

像这样使用：

```dart
new ClassWidget(
  child: new ClassWidget(),
);
```

------

在纸面上，两者似乎都在做同样的事情：创建 2 `Container`，其中一个嵌套在另一个中。但实际情况略有不同。

对于函数，生成的小部件树如下所示：

```dart
Container
  Container
```

使用类时，小部件树是：

```dart
ClassWidget
  Container
    ClassWidget
      Container
```

这很重要，因为它会改变框架在更新小部件时的行为方式。

## 为什么这很重要

通过使用函数将您的小部件树拆分为多个小部件，您将自己暴露在错误中并错过一些性能优化。

不能保证您在使用函数时**会**出现错误，但是通过使用类，您可以**保证**不会遇到这些问题。

以下是 Dartpad 上的一些交互式示例，您可以自行运行以更好地理解问题：

- https://dartpad.dev/1870e726d7e04699bc8f9d78ba71da35
  这个例子展示了如何通过将你的应用程序拆分成函数，你可能会不小心破坏诸如`AnimatedSwitcher`
- https://dartpad.dev/a869b21a2ebd2466b876a5997c9cf3f1
  此示例展示了类如何允许对小部件树进行更精细的重建，从而提高性能
- https://dartpad.dev/06842ae9e4b82fad917acb88da108eee
  这个例子展示了如何通过使用函数，在使用 InheritedWidgets（例如 Theme 或 providers）时让自己暴露于滥用 BuildContext 和面临错误

## 结论

以下是使用函数和类之间差异的精选列表：

1. 课程：

- 允许性能优化（const 构造函数，更精细的重建）
- 确保在两种不同布局之间切换正确处理资源（函数可能会重用某些先前的状态）
- 确保热重载正常工作（使用函数可能会破坏`showDialogs`类似的热重载）
- 被集成到小部件检查器中。
  - 我们`ClassWidget`在 devtool 显示的小部件树中看到，这有助于理解屏幕上的内容
  - 我们可以覆盖[debugFillProperties](https://api.flutter.dev/flutter/foundation/Diagnosticable/debugFillProperties.html)来打印传递给小部件的参数是什么
- 更好的错误消息
  如果发生异常（如 ProviderNotFound），框架将为您提供当前正在构建的小部件的名称。如果您仅在函数 + 中拆分小部件树`Builder`，您的错误将没有有用的名称
- 可以定义键
- 可以使用上下文 API

1. 职能：

- 代码更少（可以使用代码生成[功能](https://pub.dartlang.org/packages/functional_widget)解决）[functional_widget](https://pub.dartlang.org/packages/functional_widget)

总的来说，由于这些原因，在类上使用函数来重用小部件被认为是一种不好的做法。
