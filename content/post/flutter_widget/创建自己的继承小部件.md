---
title: "åˆ›å»ºè‡ªå·±çš„ç»§æ‰¿å°éƒ¨ä»¶"
date: 2021-09-06T15:19:28+08:00
draft: false
author: ""
authorLink: ""
description: ""
images: []
tags: ["Flutter","dart"]
categories: ["Flutter","dart"]
---

 

![img](https://luckly007.oss-cn-beijing.aliyuncs.com/image/studio64_KaMy5Z7UJn1.png)

è™½ç„¶æˆ‘ä»¬é€šå¸¸ä½¿ç”¨[Provider](https://pub.dev/packages/provider)æˆ–[GetIt](https://pub.dev/packages/get_it)åœ¨ Flutter ä¸­ä¼ é€’ä¿¡æ¯ï¼Œä½†æœ‰æ—¶æ‚¨ä¸æƒ³å¯¹è¿™äº›åº“æœ‰ä»»ä½•ä¾èµ–ï¼Œè€Œåªæƒ³å®šä¹‰è‡ªå·±çš„`MyFoo.of(context)`æŸ¥æ‰¾ã€‚é€šå¸¸è¿™æ˜¯æ‚¨è‡ªå·±åˆ›å»ºåŒ…çš„æ—¶å€™ã€‚

æœ‰å¾ˆå¤šæ·±å…¥ç ”ç©¶è¿™æ–¹é¢çš„æ•™ç¨‹ï¼Œä½†åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æƒ³è®©å®ƒéžå¸¸ç®€çŸ­å’Œç”œèœœã€‚



é¦–å…ˆï¼Œæ‚¨å¯èƒ½ä¼šåˆ›å»ºä¸¤ç§ä¸»è¦ç±»åž‹çš„ InheritedWidgetsï¼Œ`Stateless`(ä¸€äº›æ•°æ®)æˆ–`Stateful`(ä¸€äº›æŽ§åˆ¶å™¨)ã€‚ä¸¤è€…éƒ½éžå¸¸ç®€å•ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹æ— çŠ¶æ€ï¼

## åˆ›å»ºæ— çŠ¶æ€ç»§æ‰¿å°éƒ¨ä»¶

å‡è®¾æ‚¨æœ‰ä¸€ä¸ªå°éƒ¨ä»¶ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›æ ‘ä¸­ä½äºŽæ‚¨ä¸Šæ–¹çš„æŸä¸ªäººå‘æ‚¨ä¼ é€’ä¸€äº›ç®€å•çš„æ•°æ®ã€‚å°±åƒæ‚¨çš„å°éƒ¨ä»¶å¯èƒ½ä¾èµ–äºŽ`String`æ‚¨æƒ³è¦ç»§æ‰¿çš„ç‰¹æ®ŠåŠŸèƒ½ã€‚

**Step1)**åˆ›å»ºä¸€ä¸ªç»§æ‰¿çš„å°éƒ¨ä»¶ï¼Œå®ƒæŽ¥å—æ‚¨è¦ç»§æ‰¿çš„æ•°æ®ï¼š

```dart
class MyPathProvider extends InheritedWidget {
  MyPathProvider ({Key? key, required Widget child, required this.path}) : super(key: key, child: child);
  
  final String path;
  Widget build(BuildContext context) => child;
}
```

**Step2) å°† .of() å’Œ updateShouldNotify() æ–¹æ³•æ·»åŠ åˆ°æ‚¨çš„å°éƒ¨ä»¶ï¼š**

```dart
static MyPathProvider ? of(BuildContext context) =>
context.dependOnInheritedWidgetOfExactType<MyPathProvider>();
@override
// rebuild children if .path value changes
bool updateShouldNotify(covariant MyPathProvider oldWidget) => oldWidget.path != path;
```

**Step3)**åœ¨æ ‘ä¸­ä½¿ç”¨å°éƒ¨ä»¶ï¼š

```dart
xxxxxxxxxxÂ return MyPathProvider(path: "some/path", child: ...) 
```

ä½ å®Œæˆäº†ï¼æ‚¨çŽ°åœ¨å¯ä»¥å°è¯•ä½¿ç”¨`MyPathProvider.of(context).user`æ¥è‡ª `MyPathProvider`.

## åˆ›å»ºæœ‰çŠ¶æ€çš„ InheritedWidget

**ç¬¬ 1 æ­¥)åˆ›å»ºä¸€ä¸ª`StatefulWidget`å¸¦å­©å­çš„ï¼Œå¹¶å£°æ˜Žå®ƒçš„çŠ¶æ€ä¸ºå…¬å…±ã€‚**

```dart
class MyFoo extends StatefulWidget {
  const MyFoo({Key? key, required this.child}) : super(key: key);
  final Widget child;
  @override
  MyFooState createState() => MyFooState();
}
class MyFooState extends State<MyFoo> {
  @override
  Widget build(BuildContext context) => widget.child;
}
```

**æ­¥éª¤ 2) åˆ›å»ºä¸€ä¸ªåŒ¹é…çš„`InheritedWidget`, å¹¶ä¸ºæ‚¨çš„å·žè®¾ç½®ä¸€ä¸ªå­—æ®µã€‚**

```dart
class _MyInheritedFoo extends InheritedWidget {
  _MyInheritedFoo({Key? key, required Widget child, required this.state}) : super(key: key, child: child);
  final MyFooState state;
  @override
  // Always rebuild children if state changes
  bool updateShouldNotify(covariant InheritedWidget oldWidget) => true;
}
```

**æ­¥éª¤ 3) åœ¨çŠ¶æ€çš„`build`æ–¹æ³•ä¸­ï¼Œå°† .child åŒ…è£¹åœ¨ ä¸­`InheritedWidget`ï¼Œå¹¶å°†çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ é€’ï¼š**

```dart
Widget build(BuildContext context) {
    return _MyInheritedFoo(child: widget.child, state: this);
  }
```

**æ­¥éª¤ 4) å‘æ‚¨çš„`StatefulWidget`:**

```dart
static MyFooState of(BuildContext context) =>
    (context.dependOnInheritedWidgetOfExactType<_MyInheritedFoo>() as _MyInheritedFoo).state;
```

**Step5) åœ¨æ ‘ä¸­ä½¿ç”¨å°éƒ¨ä»¶** `return MyFoo(child: â€¦)`



**ä½ å®Œæˆäº†ï¼**æ‚¨çŽ°åœ¨å¯ä»¥ä»Žæ ‘ä¸­çš„ä»»ä½•ä½ç½®æŸ¥æ‰¾æ­¤çŠ¶æ€ï¼Œåªéœ€ä¸€ä¸ªç®€å•çš„ï¼š `MyFooState state = MyFoo.of(context);`

æ‚¨å¯ä»¥[åœ¨ github ä¸Š](https://gist.github.com/esDotDev/ad376d0e763d1e690fe902a28da3923d)æŸ¥çœ‹[å®Œæ•´çš„å·¥ä½œç¤ºä¾‹](https://gist.github.com/esDotDev/ad376d0e763d1e690fe902a28da3923d)ã€‚å¿«ä¹ç¼–ç ðŸ™‚



```dart
class MyFoo extends StatefulWidget {
  const MyFoo({Key? key, required this.child}) : super(key: key);
  final Widget child;

  @override
  MyFooState createState() => MyFooState();
  
  static MyFooState of(BuildContext context) =>
    (context.dependOnInheritedWidgetOfExactType<_MyInheritedFoo>() as _MyInheritedFoo).state;
}

class MyFooState extends State<MyFoo> {
  @override
  Widget build(BuildContext context) {
    return _MyInheritedFoo(child: widget.child, state: this);
  }
}

class _MyInheritedFoo extends InheritedWidget {
  _MyInheritedFoo({Key? key, required Widget child, required this.state}) : super(key: key, child: child);
  final MyFooState state;
  @override
  bool updateShouldNotify(covariant InheritedWidget oldWidget) => true;
}
```

